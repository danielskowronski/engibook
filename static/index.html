<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>EngiBook</title>
	<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono:400,700" rel="stylesheet">
    <script src="assets/jquery-3.1.1.min.js"></script>
	<script src="assets/pace.min.js"></script>
	<link rel="stylesheet" href="assets/pure-min.css">
	<link rel="stylesheet" href="assets/side-menu.css">
    <link rel="stylesheet" href="assets/master.css">
	<link rel="stylesheet" href="assets/pace.css">
</head>

<body>
<div id="layout">
	<a href="#menu" id="menuLink" class="menu-link"><span></span></a>

	<div id="menu"><div class="pure-menu">
	<a class="pure-menu-heading" href="#">EngiBook</a>

	<ul class="pure-menu-list">
		<!--<li class="pure-menu-item"><a href="#tags" class="pure-menu-link">tags</a></li> TODO-->

		notebooks:
		<div id="notebooks">
            <!--<li class="pure-menu-item"><a href="#notebook/$id" class="pure-menu-link">$title</a></li>-->
		</div>

		system:
		<li class="pure-menu-item"><a href="#notebooks" class="pure-menu-link">vi notebooks</a></li>
		<!--<li class="pure-menu-item"><a href="#" class="pure-menu-link">vi general</a></li> TODO-->
		<li class="pure-menu-item"><a href="#man" class="pure-menu-link">man</a></li>

	</ul>
	</div></div>

	<div id="main">
		<div class="header">
			<h1 id="title">mode selected</h1>
			<h2 id="descr">few words about this mode</h2>
		</div>

		<div class="content">
            
		</div>
	</div>
</div>

<script src="assets/ui.js"></script>
<script>
var database = {notebooks:[],notes:[]}; //locally laoded database

function updateTitle(title, descr){
    $("#title").html(title)
    $("#descr").html(descr)
}
function filterByNotebook(id){
    window.location.hash = "#notebook"
    $(".content").html();
    if (id>=0){
        updateTitle(database.notebooks[id].title,"")
    }
    else {
        updateTitle("%all% notes index","")
    }

    ;
 

}
function expandOrCollapseNote(caller){
    if (!$(caller).prop("data-expanded") || $(caller).prop("data-expanded") =="false"){
        $(caller).prop("data-expanded","true")
        $(caller).css("max-height","none")
    }
    else {
        $(caller).prop("data-expanded","false")
        $(caller).css("max-height","50px")
    }
}
function pageReloaded(){
	var action = window.location.hash.split("/")[0];
    Pace.start();
	$.getJSON( "mock/data_big.json", function( data ) {
        database.notebooks = data.notebooks;
        $("#notebooks").html("")
        $("#notebooks").append('<li class="pure-menu-item"><a href="javascript:filterByNotebook(-1)" class="pure-menu-link">%all%</a></li>')
        $.each( database.notebooks, function( key, val ) {
            $("#notebooks").append('<li class="pure-menu-item"><a href="javascript:filterByNotebook('+key+')"  class="pure-menu-link">'+val.title+'</a></li>')
        });
        
        database.notes = data.notes;
        $.each( database.notes, function( key, val ) {
            $(".content").append('<div class="noteEntry" onClick="expandOrCollapseNote(this)">'+
                '<div class="noteTitle">'+val.title+'</div>'+
                '<div class="noteBody">'+val.body+'</div>'+
                '</div>'
            )
        });
        Pace.stop();

	});

	switch (action){
	case "#trash"://TODO 
		updateTitle("trash - not implemented","shows all notes")
		break;
	case "#notebooks": //TODO: invent better route name
		updateTitle("vi notebooks","manages all notebooks, even deleted")
		break;      
    case "#man": //TODO: invent better route name
        updateTitle("man engibook","basic help")
        $(".content").html("notes (markdown/text entities with titles) belongs to notebooks<br />you can filter notes by notebooks or search by substring or regex")
        break;              
	default:
		break;
	}

    filterByNotebook(-1);
}

$(function() { pageReloaded(); });
window.onhashchange = pageReloaded;
</script>

	
</body>
</html>